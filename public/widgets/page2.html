<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 2 - Preparing Link</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        
    </style>
</head>
<body>
    <!-- ================== WIDGET 1 ================== -->
    <div id="widget1" class="pharma-widget" style="display:none; margin:20px 0; text-align:center;">
      <div class="ad-block" style="margin-bottom:15px;">
        <!-- Your ad code here -->
        <p>[Ad placement 1]</p>
      </div>
      <div id="timer1" style="font-weight:bold; font-size:18px;">Please wait <span id="time1">30</span> seconds…</div>
      <button id="btn1" style="display:none; margin-top:15px; padding:10px 20px; font-size:16px; background:#0069d9; color:white; border:none; border-radius:8px; cursor:pointer;">
        Scroll down to find the link
      </button>
    </div>

    <!-- ================== WIDGET 2 ================== -->
    <div id="widget2" class="pharma-widget" style="display:none; margin:40px 0; text-align:center;">
      <div class="ad-block" style="margin-bottom:15px;">
        <!-- Your ad code here -->
        <p>[Ad placement 2]</p>
      </div>
      <div id="timer2" style="font-weight:bold; font-size:18px;">Please wait <span id="time2">30</span> seconds…</div>
      <button id="btn2" style="display:none; margin-top:15px; padding:10px 20px; font-size:16px; background:#28a745; color:white; border:none; border-radius:8px; cursor:pointer;">
        Go to link page
      </button>
    </div>

    <script>
    (function() {
      // --- STEP 1: Handle ?ref= and cookie ---
      const params = new URLSearchParams(window.location.search);
      const code = params.get("ref");

      if (code) {
        // Store ref in a cookie (1 hour lifetime)
        document.cookie = "short_code=" + encodeURIComponent(code) + "; path=/; max-age=3600; SameSite=Lax";

        // Clean the URL (remove query instantly)
        const url = new URL(window.location);
        url.search = "";
        window.history.replaceState({}, '', url);
      }

      // --- STEP 2: Show widgets only if ref cookie exists ---
      function getCookie(name) {
        const value = "; " + document.cookie;
        const parts = value.split("; " + name + "=");
        if (parts.length === 2) return parts.pop().split(";").shift();
      }

      const refCode = getCookie("short_code");
      if (!refCode) return; // stop if no ref

      // Show both widgets
      document.getElementById('widget1').style.display = 'block';
      document.getElementById('widget2').style.display = 'block';

      // --- Widget 1 timer ---
      let timer1 = 30;
      const timeDisplay1 = document.getElementById('time1');
      const btn1 = document.getElementById('btn1');
      const interval1 = setInterval(() => {
        timer1--;
        timeDisplay1.textContent = timer1;
        if (timer1 <= 0) {
          clearInterval(interval1);
          document.getElementById('timer1').style.display = 'none';
          btn1.style.display = 'inline-block';
          // Start widget 2 timer when first ends
          startWidget2();
        }
      }, 1000);

      btn1.addEventListener('click', () => {
        document.getElementById('widget2').scrollIntoView({behavior: 'smooth'});
      });

      // --- Widget 2 timer ---
      function startWidget2(){
        let timer2 = 30;
        const timeDisplay2 = document.getElementById('time2');
        const btn2 = document.getElementById('btn2');
        const interval2 = setInterval(() => {
          timer2--;
          timeDisplay2.textContent = timer2;
          if (timer2 <= 0) {
            clearInterval(interval2);
            document.getElementById('timer2').style.display = 'none';
            btn2.style.display = 'inline-block';
          }
        }, 1000);

        btn2.addEventListener('click', () => {
          window.location.href = "https://www.pharmalite.in/p/ext-link.html";
        });
      }
    })();
    </script>

</body>
</html>
